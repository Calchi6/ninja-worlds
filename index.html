<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Ninja Worlds ‚Äî Playable Base</title>
<style>
  html,body{margin:0;height:100%;background:#1a0f0f;color:#fff;font:14px/1.15 system-ui,-apple-system,Segoe UI,Inter}
  canvas{display:block;width:100vw;height:100vh;outline:none}
  #hud{position:fixed;left:12px;top:10px;display:flex;gap:10px;z-index:5}
  .badge{background:rgba(0,0,0,.45);padding:6px 10px;border-radius:10px;font-weight:800}
  .btns{position:fixed;right:12px;top:10px;display:flex;gap:8px;z-index:5}
  .btn{border:0;border-radius:10px;padding:6px 10px;font-weight:800;cursor:pointer;background:#fff;color:#000}
  #msg{position:fixed;inset:auto 0 16px 0;display:grid;place-items:center;pointer-events:none}
  #msg span{background:rgba(0,0,0,.55);padding:8px 12px;border-radius:12px;font-weight:700}
</style>
</head>
<body>
<canvas id="game" aria-label="Ninja Worlds ‚Äî Playable Base"></canvas>

<div id="hud">
  <div id="coins" class="badge">Coins: 0</div>
  <div id="tips"  class="badge">Move: ‚Üê‚Üí / A D ¬∑ Jump: Space ¬∑ Pause: P</div>
</div>
<div class="btns">
  <button id="mute" class="btn">üîä</button>
  <button id="pause" class="btn">Pause</button>
  <button id="reset" class="btn">Reset</button>
</div>
<div id="msg" hidden><span id="msgText">You win!</span></div>

<script>
/* ===== canvas setup (CSS px physics) ===== */
const C = document.getElementById('game');
const g = C.getContext('2d');
function fit(){
  const dpr = devicePixelRatio||1;
  C.width  = Math.round(innerWidth * dpr);
  C.height = Math.round(innerHeight* dpr);
  g.setTransform(dpr,0,0,dpr,0,0);
}
addEventListener('resize', fit); fit();

/* ===== tiny audio (beep only) ===== */
let muted=false;
document.getElementById('mute').onclick=()=>{ muted=!muted; mute.textContent = muted?'üîá':'üîä'; };
function beep(f=600,d=.06,v=.05){
  if(muted) return;
  try{
    const AC=window.AudioContext||window.webkitAudioContext; if(!AC) return;
    if(!window._ac) window._ac=new AC();
    const ac=_ac, o=ac.createOscillator(), g=ac.createGain();
    o.type='square'; o.frequency.value=f; g.gain.value=v;
    o.connect(g); g.connect(ac.destination); o.start(); o.stop(ac.currentTime+d);
  }catch(_){}
}

/* ===== world ===== */
const TILE=24;
const LEVEL = {
  // ground & gaps (as in your screenshot)
  ground: [
    {x:0,   w:36},
    {x:42,  w:22},
    {x:72,  w:18},
    {x:98,  w:46},
    {x:152, w:30}
  ],
  // small raised platforms (dark slates)
  slabs: [
    // left island
    {x:18,y:-4,w:5},{x:24,y:-4,w:5},{x:30,y:-4,w:5},
    // middle island
    {x:64,y:-6,w:4},{x:69,y:-6,w:4},{x:74,y:-6,w:4},
    // right island
    {x:122,y:-6,w:4},{x:127,y:-6,w:4},{x:132,y:-6,w:4}
  ],
  // coins on top (yellow dots)
  coins: [
    {x:21.5,y:-5.2},{x:67.5,y:-7.2},{x:129.5,y:-7.2}
  ],
  // simple ‚Äúgoal‚Äù pillar to the far right
  goal: {x:146, h:6}
};

const HUD = {
  coins: document.getElementById('coins'),
  msg: document.getElementById('msg'),
  msgText: document.getElementById('msgText')
};

let running=true;
document.getElementById('pause').onclick=()=>{ running=!running; pause.textContent=running?'Pause':'Resume'; };
document.getElementById('reset').onclick=()=>reset();

/* ===== player (Mario-ish feel) ===== */
const CFG = {
  GRAV: 2400,
  MAX_FALL: 1400,
  RUN: 340,
  AIR_ACCEL: 2200,
  GROUND_ACCEL: 5200,
  FRICTION: 12,         // higher = stickier stop
  JUMP_V: 720,
  CUT_JUMP_V: 180,      // jump cut when releasing early
};
const player = {x: TILE*4, y: 0, w: 16, h: 22, vx: 0, vy: 0, on:false, face:1, coins:0};

function worldHeightPx(){ return C.height - TILE*6; } // baseline ground band

/* ===== input ===== */
const keys=Object.create(null);
addEventListener('keydown',e=>{
  const k=e.key.toLowerCase(); keys[k]=true;
  if([' ','arrowleft','arrowright'].includes(e.key)) e.preventDefault();
  if(k==='p') { running=!running; pause.textContent=running?'Pause':'Resume'; }
});
addEventListener('keyup',e=>{ keys[e.key.toLowerCase()]=false; });
addEventListener('blur', ()=>{ for(const k in keys) keys[k]=false; });

/* ===== helpers ===== */
function clamp(v,a,b){ return Math.max(a,Math.min(b,v)); }
function AABB(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }
function rect(x,y,w,h){ g.fillRect(Math.floor(x),Math.floor(y),w,h); }

/* ===== collision against level ===== */
function platforms(){
  const baseY = worldHeightPx();
  const segs = [];

  // ground segments
  for(const s of LEVEL.ground){
    segs.push({x:s.x*TILE, y:baseY, w:s.w*TILE, h:TILE});
  }
  // slabs (raised blocks)
  for(const s of LEVEL.slabs){
    const y = baseY + s.y*TILE;
    segs.push({x:s.x*TILE, y:y, w:s.w*TILE, h:TILE});
  }
  // goal pillar
  segs.push({x:LEVEL.goal.x*TILE, y:baseY - LEVEL.goal.h*TILE, w:10, h:LEVEL.goal.h*TILE});
  return segs;
}

function resolveCollisions(p, segs, dx, dy){
  // move X
  p.x += dx;
  for(const s of segs){
    if(AABB(p,s)){
      if(dx>0) p.x = s.x - p.w;
      else     p.x = s.x + s.w;
      p.vx = 0;
    }
  }
  // move Y
  p.y += dy; p.on=false;
  for(const s of segs){
    if(AABB(p,s)){
      if(dy>0){ p.y = s.y - p.h; p.vy = 0; p.on = true; }
      else     { p.y = s.y + s.h; if(p.vy<0) p.vy = 0; }
    }
  }
}

/* ===== update ===== */
function update(dt){
  // input
  const left  = keys.a||keys.arrowleft;
  const right = keys.d||keys.arrowright;
  const jump  = keys[' ']||keys.space;

  // horizontal accel (Mario-ish: big ground accel, lighter air control)
  const accel = player.on ? CFG.GROUND_ACCEL : CFG.AIR_ACCEL;
  let ax = (right?1:0) - (left?1:0);
  player.vx += ax * accel * dt;
  player.vx = clamp(player.vx, -CFG.RUN, CFG.RUN);
  if(ax===0 && player.on){
    player.vx *= Math.max(0, 1 - CFG.FRICTION*dt);
    if(Math.abs(player.vx)<12) player.vx = 0;
  }
  if(right) player.face=1; if(left) player.face=-1;

  // jumping
  if(jump && player.on){
    player.vy = -CFG.JUMP_V;
    player.on=false; keys[' ']=keys.space=false;
    beep(700,.06,.05);
  }
  // short-hop if released early
  if(!(keys[' ']||keys.space) && player.vy < -CFG.CUT_JUMP_V){
    player.vy = -CFG.CUT_JUMP_V;
  }

  // gravity
  player.vy += CFG.GRAV*dt;
  if(player.vy > CFG.MAX_FALL) player.vy = CFG.MAX_FALL;

  // integrate + collide
  const dx = player.vx*dt, dy = player.vy*dt;
  resolveCollisions(player, platforms(), dx, dy);

  // coins pickup
  for(let i=LEVEL.coins.length-1;i>=0;i--){
    const c = LEVEL.coins[i];
    const r = {x:c.x*TILE-5, y:worldHeightPx()+c.y*TILE-5, w:10, h:10};
    if(AABB(player,r)){ LEVEL.coins.splice(i,1); player.coins++; HUD.coins.textContent = 'Coins: '+player.coins; beep(880,.05,.05); }
  }

  // win if touch goal pillar side
  const goalRect = {x:LEVEL.goal.x*TILE, y:worldHeightPx()-LEVEL.goal.h*TILE, w:10, h:LEVEL.goal.h*TILE};
  if(AABB(player, goalRect)){
    running=false;
    HUD.msgText.textContent='You Win! üéâ';
    HUD.msg.hidden=false;
  }

  // death pit safeguard
  const floorY = worldHeightPx()+TILE*2;
  if(player.y>floorY){ reset(); }
}

/* ===== render ===== */
function draw(t){
  const cw = C.width/(devicePixelRatio||1);
  const ch = C.height/(devicePixelRatio||1);

  // sky gradient (crimson dusk)
  const wobble = Math.sin(t*0.3)*18;
  const grad = g.createLinearGradient(0,0,0,ch+wobble);
  grad.addColorStop(0.00,'#f08a7a');
  grad.addColorStop(0.40,'#c1494f');
  grad.addColorStop(1.00,'#8a1f2b');
  g.fillStyle = grad; g.fillRect(0,0,cw,ch);

  // ground band
  g.fillStyle = '#2a1c22';
  for(const s of LEVEL.ground){
    const x=s.x*TILE, y=worldHeightPx(), w=s.w*TILE, h=TILE;
    rect(x,y,w,h);
  }

  // slabs
  g.fillStyle = '#43506a';
  for(const s of LEVEL.slabs){
    const x=s.x*TILE, y=worldHeightPx()+s.y*TILE, w=s.w*TILE, h=TILE;
    rect(x,y,w,h);
  }

  // goal pillar
  g.fillStyle = '#3aff76';
  rect(LEVEL.goal.x*TILE, worldHeightPx()-LEVEL.goal.h*TILE, 10, LEVEL.goal.h*TILE);

  // coins
  g.fillStyle='gold';
  for(const c of LEVEL.coins){
    const x=c.x*TILE, y=worldHeightPx()+c.y*TILE;
    g.beginPath(); g.arc(x,y,5,0,Math.PI*2); g.fill();
  }

  // player (white rect)
  g.fillStyle='#fff';
  rect(player.x, player.y, player.w, player.h);
}

/* ===== loop ===== */
let last=performance.now();
function frame(now){
  const dt=Math.min(50, now-last)/1000; last=now;
  if(running) update(dt);
  draw(now/1000);
  requestAnimationFrame(frame);
}
requestAnimationFrame(frame);

/* ===== reset / start ===== */
function reset(){
  player.x=TILE*4; player.y=worldHeightPx()-player.h-1;
  player.vx=0; player.vy=0; player.on=false; HUD.msg.hidden=true;
  // restore coins (optional comment out if you want them persistent)
  LEVEL.coins = [{x:21.5,y:-5.2},{x:67.5,y:-7.2},{x:129.5,y:-7.2}];
  player.coins=0; HUD.coins.textContent='Coins: 0';
}
reset();
C.focus();
</script>
</body>
</html>
